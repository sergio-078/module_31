{% extends "default.html" %}
{% load i18n %}
{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">{% trans "Subscriptions" %}</div>
            <div class="card-body">
                <form method="post" action="{% url 'news_subscribe' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn w-100 {% if news_subscribed %}btn-danger{% else %}btn-success{% endif %} mb-3">
                        {% if news_subscribed %}{% trans "Unsubscribe from News" %}{% else %}{% trans "Subscribe to News" %}{% endif %}
                    </button>
                </form>

                <h5>{% trans "Categories" %}</h5>
                <ul class="list-group">
                    {% for category in categories %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ category.name }}
                            <form method="post" action="{% url 'category_subscribe' category.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm {% if category.id in subscribed_categories %}btn-danger{% else %}btn-success{% endif %}">
                                    {% if category.id in subscribed_categories %}{% trans "Unsub" %}{% else %}{% trans "Sub" %}{% endif %}
                                </button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#posts" type="button">
                    {% trans "My Posts" %}
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#responses" type="button">
                    {% trans "Responses to Me" %}
                </button>
            </li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="posts">
                {% for post in user_posts %}
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5>{{ post.title }}</h5>
                            <a href="{% url 'post_detail' post.pk %}" class="btn btn-sm btn-outline-primary">{% trans "View" %}</a>
                            <a href="{% url 'post_edit' post.pk %}" class="btn btn-sm btn-outline-secondary">{% trans "Edit" %}</a>
                        </div>
                    </div>
                {% empty %}
                    <div class="alert alert-info mt-3">{% trans "You have no posts yet" %}</div>
                {% endfor %}
            </div>

            <div class="tab-pane fade" id="responses">
                {% for response in responses_to_posts %}
                    <div class="card mb-3 {% if response.is_accepted %}border-success{% endif %}">
                        <div class="card-body">
                            <p>{{ response.text }}</p>
                            <small>
                                {{ response.created_at|date }} |
                                <a href="{% url 'post_detail' response.post.pk %}">{{ response.post.title }}</a>
                            </small>
                            {% if not response.is_accepted %}
                                <a href="{% url 'accept_response' response.pk %}" class="btn btn-sm btn-success">{% trans "Accept" %}</a>
                            {% endif %}
                            <a href="{% url 'response_delete' response.pk %}" class="btn btn-sm btn-danger">{% trans "Delete" %}</a>
                        </div>
                    </div>
                {% empty %}
                    <div class="alert alert-info mt-3">{% trans "No responses to your posts" %}</div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Активация табов
    const tabElms = document.querySelectorAll('button[data-bs-toggle="tab"]');
    tabElms.forEach(tabEl => {
        tabEl.addEventListener('click', event => {
            event.preventDefault();
            const tab = new bootstrap.Tab(event.target);
            tab.show();
        });
    });
</script>
{% endblock %}